#!/bin/sh

BUILD_DIR=$1
CACHE_DIR=$2

indent() {
  sed -u 's/^/       /'
}

message() {
  echo "-----> $*"
}

-# Install Jekyll into $CACHE_DIR/.gems
cat << EOF > ~/.gemrc
gemhome: $CACHE_DIR/gems
gempath:
- $CACHE_DIR/gems
EOF

export PATH=$CACHE_DIR/gems:$PATH
export LC_ALL=en_US.UTF8

message "Installing bundler"
/usr/local/bin/gem install bundler


cd $BUILD_DIR

message "Installing bundle"
bundle install

message "Compiling Jekyll site"
bundle exec jekyll public --no-auto --no-server | indent
